{"ast":null,"code":"'use strict';\n\nconst {\n  Buffer\n} = require('buffer');\n\nconst {\n  URL\n} = require('iso-url');\n\nconst Bignumber = require('bignumber.js').BigNumber;\n\nconst utils = require('./utils');\n\nconst constants = require('./constants');\n\nconst MT = constants.MT;\nconst NUMBYTES = constants.NUMBYTES;\nconst SHIFT32 = constants.SHIFT32;\nconst SYMS = constants.SYMS;\nconst TAG = constants.TAG;\nconst HALF = constants.MT.SIMPLE_FLOAT << 5 | constants.NUMBYTES.TWO;\nconst FLOAT = constants.MT.SIMPLE_FLOAT << 5 | constants.NUMBYTES.FOUR;\nconst DOUBLE = constants.MT.SIMPLE_FLOAT << 5 | constants.NUMBYTES.EIGHT;\nconst TRUE = constants.MT.SIMPLE_FLOAT << 5 | constants.SIMPLE.TRUE;\nconst FALSE = constants.MT.SIMPLE_FLOAT << 5 | constants.SIMPLE.FALSE;\nconst UNDEFINED = constants.MT.SIMPLE_FLOAT << 5 | constants.SIMPLE.UNDEFINED;\nconst NULL = constants.MT.SIMPLE_FLOAT << 5 | constants.SIMPLE.NULL;\nconst MAXINT_BN = new Bignumber('0x20000000000000');\nconst BUF_NAN = Buffer.from('f97e00', 'hex');\nconst BUF_INF_NEG = Buffer.from('f9fc00', 'hex');\nconst BUF_INF_POS = Buffer.from('f97c00', 'hex');\n\nfunction toType(obj) {\n  // [object Type]\n  // --------8---1\n  return {}.toString.call(obj).slice(8, -1);\n}\n/**\n * Transform JavaScript values into CBOR bytes\n *\n */\n\n\nclass Encoder {\n  /**\n   * @param {Object} [options={}]\n   * @param {function(Buffer)} options.stream\n   */\n  constructor(options) {\n    options = options || {};\n    this.streaming = typeof options.stream === 'function';\n    this.onData = options.stream;\n    this.semanticTypes = [[URL, this._pushUrl], [Bignumber, this._pushBigNumber]];\n    const addTypes = options.genTypes || [];\n    const len = addTypes.length;\n\n    for (let i = 0; i < len; i++) {\n      this.addSemanticType(addTypes[i][0], addTypes[i][1]);\n    }\n\n    this._reset();\n  }\n\n  addSemanticType(type, fun) {\n    const len = this.semanticTypes.length;\n\n    for (let i = 0; i < len; i++) {\n      const typ = this.semanticTypes[i][0];\n\n      if (typ === type) {\n        const old = this.semanticTypes[i][1];\n        this.semanticTypes[i][1] = fun;\n        return old;\n      }\n    }\n\n    this.semanticTypes.push([type, fun]);\n    return null;\n  }\n\n  push(val) {\n    if (!val) {\n      return true;\n    }\n\n    this.result[this.offset] = val;\n    this.resultMethod[this.offset] = 0;\n    this.resultLength[this.offset] = val.length;\n    this.offset++;\n\n    if (this.streaming) {\n      this.onData(this.finalize());\n    }\n\n    return true;\n  }\n\n  pushWrite(val, method, len) {\n    this.result[this.offset] = val;\n    this.resultMethod[this.offset] = method;\n    this.resultLength[this.offset] = len;\n    this.offset++;\n\n    if (this.streaming) {\n      this.onData(this.finalize());\n    }\n\n    return true;\n  }\n\n  _pushUInt8(val) {\n    return this.pushWrite(val, 1, 1);\n  }\n\n  _pushUInt16BE(val) {\n    return this.pushWrite(val, 2, 2);\n  }\n\n  _pushUInt32BE(val) {\n    return this.pushWrite(val, 3, 4);\n  }\n\n  _pushDoubleBE(val) {\n    return this.pushWrite(val, 4, 8);\n  }\n\n  _pushNaN() {\n    return this.push(BUF_NAN);\n  }\n\n  _pushInfinity(obj) {\n    const half = obj < 0 ? BUF_INF_NEG : BUF_INF_POS;\n    return this.push(half);\n  }\n\n  _pushFloat(obj) {\n    const b2 = Buffer.allocUnsafe(2);\n\n    if (utils.writeHalf(b2, obj)) {\n      if (utils.parseHalf(b2) === obj) {\n        return this._pushUInt8(HALF) && this.push(b2);\n      }\n    }\n\n    const b4 = Buffer.allocUnsafe(4);\n    b4.writeFloatBE(obj, 0);\n\n    if (b4.readFloatBE(0) === obj) {\n      return this._pushUInt8(FLOAT) && this.push(b4);\n    }\n\n    return this._pushUInt8(DOUBLE) && this._pushDoubleBE(obj);\n  }\n\n  _pushInt(obj, mt, orig) {\n    const m = mt << 5;\n\n    if (obj < 24) {\n      return this._pushUInt8(m | obj);\n    }\n\n    if (obj <= 0xff) {\n      return this._pushUInt8(m | NUMBYTES.ONE) && this._pushUInt8(obj);\n    }\n\n    if (obj <= 0xffff) {\n      return this._pushUInt8(m | NUMBYTES.TWO) && this._pushUInt16BE(obj);\n    }\n\n    if (obj <= 0xffffffff) {\n      return this._pushUInt8(m | NUMBYTES.FOUR) && this._pushUInt32BE(obj);\n    }\n\n    if (obj <= Number.MAX_SAFE_INTEGER) {\n      return this._pushUInt8(m | NUMBYTES.EIGHT) && this._pushUInt32BE(Math.floor(obj / SHIFT32)) && this._pushUInt32BE(obj % SHIFT32);\n    }\n\n    if (mt === MT.NEG_INT) {\n      return this._pushFloat(orig);\n    }\n\n    return this._pushFloat(obj);\n  }\n\n  _pushIntNum(obj) {\n    if (obj < 0) {\n      return this._pushInt(-obj - 1, MT.NEG_INT, obj);\n    } else {\n      return this._pushInt(obj, MT.POS_INT);\n    }\n  }\n\n  _pushNumber(obj) {\n    switch (false) {\n      case obj === obj:\n        // eslint-disable-line\n        return this._pushNaN(obj);\n\n      case isFinite(obj):\n        return this._pushInfinity(obj);\n\n      case obj % 1 !== 0:\n        return this._pushIntNum(obj);\n\n      default:\n        return this._pushFloat(obj);\n    }\n  }\n\n  _pushString(obj) {\n    const len = Buffer.byteLength(obj, 'utf8');\n    return this._pushInt(len, MT.UTF8_STRING) && this.pushWrite(obj, 5, len);\n  }\n\n  _pushBoolean(obj) {\n    return this._pushUInt8(obj ? TRUE : FALSE);\n  }\n\n  _pushUndefined(obj) {\n    return this._pushUInt8(UNDEFINED);\n  }\n\n  _pushArray(gen, obj) {\n    const len = obj.length;\n\n    if (!gen._pushInt(len, MT.ARRAY)) {\n      return false;\n    }\n\n    for (let j = 0; j < len; j++) {\n      if (!gen.pushAny(obj[j])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  _pushTag(tag) {\n    return this._pushInt(tag, MT.TAG);\n  }\n\n  _pushDate(gen, obj) {\n    // Round date, to get seconds since 1970-01-01 00:00:00 as defined in\n    // Sec. 2.4.1 and get a possibly more compact encoding. Note that it is\n    // still allowed to encode fractions of seconds which can be achieved by\n    // changing overwriting the encode function for Date objects.\n    return gen._pushTag(TAG.DATE_EPOCH) && gen.pushAny(Math.round(obj / 1000));\n  }\n\n  _pushBuffer(gen, obj) {\n    return gen._pushInt(obj.length, MT.BYTE_STRING) && gen.push(obj);\n  }\n\n  _pushNoFilter(gen, obj) {\n    return gen._pushBuffer(gen, obj.slice());\n  }\n\n  _pushRegexp(gen, obj) {\n    return gen._pushTag(TAG.REGEXP) && gen.pushAny(obj.source);\n  }\n\n  _pushSet(gen, obj) {\n    if (!gen._pushInt(obj.size, MT.ARRAY)) {\n      return false;\n    }\n\n    for (const x of obj) {\n      if (!gen.pushAny(x)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  _pushUrl(gen, obj) {\n    return gen._pushTag(TAG.URI) && gen.pushAny(obj.format());\n  }\n\n  _pushBigint(obj) {\n    let tag = TAG.POS_BIGINT;\n\n    if (obj.isNegative()) {\n      obj = obj.negated().minus(1);\n      tag = TAG.NEG_BIGINT;\n    }\n\n    let str = obj.toString(16);\n\n    if (str.length % 2) {\n      str = '0' + str;\n    }\n\n    const buf = Buffer.from(str, 'hex');\n    return this._pushTag(tag) && this._pushBuffer(this, buf);\n  }\n\n  _pushBigNumber(gen, obj) {\n    if (obj.isNaN()) {\n      return gen._pushNaN();\n    }\n\n    if (!obj.isFinite()) {\n      return gen._pushInfinity(obj.isNegative() ? -Infinity : Infinity);\n    }\n\n    if (obj.isInteger()) {\n      return gen._pushBigint(obj);\n    }\n\n    if (!(gen._pushTag(TAG.DECIMAL_FRAC) && gen._pushInt(2, MT.ARRAY))) {\n      return false;\n    }\n\n    const dec = obj.decimalPlaces();\n    const slide = obj.multipliedBy(new Bignumber(10).pow(dec));\n\n    if (!gen._pushIntNum(-dec)) {\n      return false;\n    }\n\n    if (slide.abs().isLessThan(MAXINT_BN)) {\n      return gen._pushIntNum(slide.toNumber());\n    } else {\n      return gen._pushBigint(slide);\n    }\n  }\n\n  _pushMap(gen, obj) {\n    if (!gen._pushInt(obj.size, MT.MAP)) {\n      return false;\n    }\n\n    return this._pushRawMap(obj.size, Array.from(obj));\n  }\n\n  _pushObject(obj) {\n    if (!obj) {\n      return this._pushUInt8(NULL);\n    }\n\n    var len = this.semanticTypes.length;\n\n    for (var i = 0; i < len; i++) {\n      if (obj instanceof this.semanticTypes[i][0]) {\n        return this.semanticTypes[i][1].call(obj, this, obj);\n      }\n    }\n\n    var f = obj.encodeCBOR;\n\n    if (typeof f === 'function') {\n      return f.call(obj, this);\n    }\n\n    var keys = Object.keys(obj);\n    var keyLength = keys.length;\n\n    if (!this._pushInt(keyLength, MT.MAP)) {\n      return false;\n    }\n\n    return this._pushRawMap(keyLength, keys.map(k => [k, obj[k]]));\n  }\n\n  _pushRawMap(len, map) {\n    // Sort keys for canoncialization\n    // 1. encode key\n    // 2. shorter key comes before longer key\n    // 3. same length keys are sorted with lower\n    //    byte value before higher\n    map = map.map(function (a) {\n      a[0] = Encoder.encode(a[0]);\n      return a;\n    }).sort(utils.keySorter);\n\n    for (var j = 0; j < len; j++) {\n      if (!this.push(map[j][0])) {\n        return false;\n      }\n\n      if (!this.pushAny(map[j][1])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n  /**\n   * Alias for `.pushAny`\n   *\n   * @param {*} obj\n   * @returns {boolean} true on success\n   */\n\n\n  write(obj) {\n    return this.pushAny(obj);\n  }\n  /**\n   * Push any supported type onto the encoded stream\n   *\n   * @param {any} obj\n   * @returns {boolean} true on success\n   */\n\n\n  pushAny(obj) {\n    var typ = toType(obj);\n\n    switch (typ) {\n      case 'Number':\n        return this._pushNumber(obj);\n\n      case 'String':\n        return this._pushString(obj);\n\n      case 'Boolean':\n        return this._pushBoolean(obj);\n\n      case 'Object':\n        return this._pushObject(obj);\n\n      case 'Array':\n        return this._pushArray(this, obj);\n\n      case 'Uint8Array':\n        return this._pushBuffer(this, Buffer.isBuffer(obj) ? obj : Buffer.from(obj));\n\n      case 'Null':\n        return this._pushUInt8(NULL);\n\n      case 'Undefined':\n        return this._pushUndefined(obj);\n\n      case 'Map':\n        return this._pushMap(this, obj);\n\n      case 'Set':\n        return this._pushSet(this, obj);\n\n      case 'URL':\n        return this._pushUrl(this, obj);\n\n      case 'BigNumber':\n        return this._pushBigNumber(this, obj);\n\n      case 'Date':\n        return this._pushDate(this, obj);\n\n      case 'RegExp':\n        return this._pushRegexp(this, obj);\n\n      case 'Symbol':\n        switch (obj) {\n          case SYMS.NULL:\n            return this._pushObject(null);\n\n          case SYMS.UNDEFINED:\n            return this._pushUndefined(undefined);\n          // TODO: Add pluggable support for other symbols\n\n          default:\n            throw new Error('Unknown symbol: ' + obj.toString());\n        }\n\n      default:\n        throw new Error('Unknown type: ' + typeof obj + ', ' + (obj ? obj.toString() : ''));\n    }\n  }\n\n  finalize() {\n    if (this.offset === 0) {\n      return null;\n    }\n\n    var result = this.result;\n    var resultLength = this.resultLength;\n    var resultMethod = this.resultMethod;\n    var offset = this.offset; // Determine the size of the buffer\n\n    var size = 0;\n    var i = 0;\n\n    for (; i < offset; i++) {\n      size += resultLength[i];\n    }\n\n    var res = Buffer.allocUnsafe(size);\n    var index = 0;\n    var length = 0; // Write the content into the result buffer\n\n    for (i = 0; i < offset; i++) {\n      length = resultLength[i];\n\n      switch (resultMethod[i]) {\n        case 0:\n          result[i].copy(res, index);\n          break;\n\n        case 1:\n          res.writeUInt8(result[i], index, true);\n          break;\n\n        case 2:\n          res.writeUInt16BE(result[i], index, true);\n          break;\n\n        case 3:\n          res.writeUInt32BE(result[i], index, true);\n          break;\n\n        case 4:\n          res.writeDoubleBE(result[i], index, true);\n          break;\n\n        case 5:\n          res.write(result[i], index, length, 'utf8');\n          break;\n\n        default:\n          throw new Error('unkown method');\n      }\n\n      index += length;\n    }\n\n    var tmp = res;\n\n    this._reset();\n\n    return tmp;\n  }\n\n  _reset() {\n    this.result = [];\n    this.resultMethod = [];\n    this.resultLength = [];\n    this.offset = 0;\n  }\n  /**\n   * Encode the given value\n   * @param {*} o\n   * @returns {Buffer}\n   */\n\n\n  static encode(o) {\n    const enc = new Encoder();\n    const ret = enc.pushAny(o);\n\n    if (!ret) {\n      throw new Error('Failed to encode input');\n    }\n\n    return enc.finalize();\n  }\n\n}\n\nmodule.exports = Encoder;","map":{"version":3,"sources":["Z:/Projects/EtherealOrgan/Complete Project/client/node_modules/borc/src/encoder.js"],"names":["Buffer","require","URL","Bignumber","BigNumber","utils","constants","MT","NUMBYTES","SHIFT32","SYMS","TAG","HALF","SIMPLE_FLOAT","TWO","FLOAT","FOUR","DOUBLE","EIGHT","TRUE","SIMPLE","FALSE","UNDEFINED","NULL","MAXINT_BN","BUF_NAN","from","BUF_INF_NEG","BUF_INF_POS","toType","obj","toString","call","slice","Encoder","constructor","options","streaming","stream","onData","semanticTypes","_pushUrl","_pushBigNumber","addTypes","genTypes","len","length","i","addSemanticType","_reset","type","fun","typ","old","push","val","result","offset","resultMethod","resultLength","finalize","pushWrite","method","_pushUInt8","_pushUInt16BE","_pushUInt32BE","_pushDoubleBE","_pushNaN","_pushInfinity","half","_pushFloat","b2","allocUnsafe","writeHalf","parseHalf","b4","writeFloatBE","readFloatBE","_pushInt","mt","orig","m","ONE","Number","MAX_SAFE_INTEGER","Math","floor","NEG_INT","_pushIntNum","POS_INT","_pushNumber","isFinite","_pushString","byteLength","UTF8_STRING","_pushBoolean","_pushUndefined","_pushArray","gen","ARRAY","j","pushAny","_pushTag","tag","_pushDate","DATE_EPOCH","round","_pushBuffer","BYTE_STRING","_pushNoFilter","_pushRegexp","REGEXP","source","_pushSet","size","x","URI","format","_pushBigint","POS_BIGINT","isNegative","negated","minus","NEG_BIGINT","str","buf","isNaN","Infinity","isInteger","DECIMAL_FRAC","dec","decimalPlaces","slide","multipliedBy","pow","abs","isLessThan","toNumber","_pushMap","MAP","_pushRawMap","Array","_pushObject","f","encodeCBOR","keys","Object","keyLength","map","k","a","encode","sort","keySorter","write","isBuffer","undefined","Error","res","index","copy","writeUInt8","writeUInt16BE","writeUInt32BE","writeDoubleBE","tmp","o","enc","ret","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst { Buffer } = require('buffer')\nconst { URL } = require('iso-url')\nconst Bignumber = require('bignumber.js').BigNumber\n\nconst utils = require('./utils')\nconst constants = require('./constants')\nconst MT = constants.MT\nconst NUMBYTES = constants.NUMBYTES\nconst SHIFT32 = constants.SHIFT32\nconst SYMS = constants.SYMS\nconst TAG = constants.TAG\nconst HALF = (constants.MT.SIMPLE_FLOAT << 5) | constants.NUMBYTES.TWO\nconst FLOAT = (constants.MT.SIMPLE_FLOAT << 5) | constants.NUMBYTES.FOUR\nconst DOUBLE = (constants.MT.SIMPLE_FLOAT << 5) | constants.NUMBYTES.EIGHT\nconst TRUE = (constants.MT.SIMPLE_FLOAT << 5) | constants.SIMPLE.TRUE\nconst FALSE = (constants.MT.SIMPLE_FLOAT << 5) | constants.SIMPLE.FALSE\nconst UNDEFINED = (constants.MT.SIMPLE_FLOAT << 5) | constants.SIMPLE.UNDEFINED\nconst NULL = (constants.MT.SIMPLE_FLOAT << 5) | constants.SIMPLE.NULL\n\nconst MAXINT_BN = new Bignumber('0x20000000000000')\nconst BUF_NAN = Buffer.from('f97e00', 'hex')\nconst BUF_INF_NEG = Buffer.from('f9fc00', 'hex')\nconst BUF_INF_POS = Buffer.from('f97c00', 'hex')\n\nfunction toType (obj) {\n  // [object Type]\n  // --------8---1\n  return ({}).toString.call(obj).slice(8, -1)\n}\n\n/**\n * Transform JavaScript values into CBOR bytes\n *\n */\nclass Encoder {\n  /**\n   * @param {Object} [options={}]\n   * @param {function(Buffer)} options.stream\n   */\n  constructor (options) {\n    options = options || {}\n\n    this.streaming = typeof options.stream === 'function'\n    this.onData = options.stream\n\n    this.semanticTypes = [\n      [URL, this._pushUrl],\n      [Bignumber, this._pushBigNumber]\n    ]\n\n    const addTypes = options.genTypes || []\n    const len = addTypes.length\n    for (let i = 0; i < len; i++) {\n      this.addSemanticType(\n        addTypes[i][0],\n        addTypes[i][1]\n      )\n    }\n\n    this._reset()\n  }\n\n  addSemanticType (type, fun) {\n    const len = this.semanticTypes.length\n    for (let i = 0; i < len; i++) {\n      const typ = this.semanticTypes[i][0]\n      if (typ === type) {\n        const old = this.semanticTypes[i][1]\n        this.semanticTypes[i][1] = fun\n        return old\n      }\n    }\n    this.semanticTypes.push([type, fun])\n    return null\n  }\n\n  push (val) {\n    if (!val) {\n      return true\n    }\n\n    this.result[this.offset] = val\n    this.resultMethod[this.offset] = 0\n    this.resultLength[this.offset] = val.length\n    this.offset++\n\n    if (this.streaming) {\n      this.onData(this.finalize())\n    }\n\n    return true\n  }\n\n  pushWrite (val, method, len) {\n    this.result[this.offset] = val\n    this.resultMethod[this.offset] = method\n    this.resultLength[this.offset] = len\n    this.offset++\n\n    if (this.streaming) {\n      this.onData(this.finalize())\n    }\n\n    return true\n  }\n\n  _pushUInt8 (val) {\n    return this.pushWrite(val, 1, 1)\n  }\n\n  _pushUInt16BE (val) {\n    return this.pushWrite(val, 2, 2)\n  }\n\n  _pushUInt32BE (val) {\n    return this.pushWrite(val, 3, 4)\n  }\n\n  _pushDoubleBE (val) {\n    return this.pushWrite(val, 4, 8)\n  }\n\n  _pushNaN () {\n    return this.push(BUF_NAN)\n  }\n\n  _pushInfinity (obj) {\n    const half = (obj < 0) ? BUF_INF_NEG : BUF_INF_POS\n    return this.push(half)\n  }\n\n  _pushFloat (obj) {\n    const b2 = Buffer.allocUnsafe(2)\n\n    if (utils.writeHalf(b2, obj)) {\n      if (utils.parseHalf(b2) === obj) {\n        return this._pushUInt8(HALF) && this.push(b2)\n      }\n    }\n\n    const b4 = Buffer.allocUnsafe(4)\n    b4.writeFloatBE(obj, 0)\n    if (b4.readFloatBE(0) === obj) {\n      return this._pushUInt8(FLOAT) && this.push(b4)\n    }\n\n    return this._pushUInt8(DOUBLE) && this._pushDoubleBE(obj)\n  }\n\n  _pushInt (obj, mt, orig) {\n    const m = mt << 5\n    if (obj < 24) {\n      return this._pushUInt8(m | obj)\n    }\n\n    if (obj <= 0xff) {\n      return this._pushUInt8(m | NUMBYTES.ONE) && this._pushUInt8(obj)\n    }\n\n    if (obj <= 0xffff) {\n      return this._pushUInt8(m | NUMBYTES.TWO) && this._pushUInt16BE(obj)\n    }\n\n    if (obj <= 0xffffffff) {\n      return this._pushUInt8(m | NUMBYTES.FOUR) && this._pushUInt32BE(obj)\n    }\n\n    if (obj <= Number.MAX_SAFE_INTEGER) {\n      return this._pushUInt8(m | NUMBYTES.EIGHT) &&\n        this._pushUInt32BE(Math.floor(obj / SHIFT32)) &&\n        this._pushUInt32BE(obj % SHIFT32)\n    }\n\n    if (mt === MT.NEG_INT) {\n      return this._pushFloat(orig)\n    }\n\n    return this._pushFloat(obj)\n  }\n\n  _pushIntNum (obj) {\n    if (obj < 0) {\n      return this._pushInt(-obj - 1, MT.NEG_INT, obj)\n    } else {\n      return this._pushInt(obj, MT.POS_INT)\n    }\n  }\n\n  _pushNumber (obj) {\n    switch (false) {\n      case (obj === obj): // eslint-disable-line\n        return this._pushNaN(obj)\n      case isFinite(obj):\n        return this._pushInfinity(obj)\n      case ((obj % 1) !== 0):\n        return this._pushIntNum(obj)\n      default:\n        return this._pushFloat(obj)\n    }\n  }\n\n  _pushString (obj) {\n    const len = Buffer.byteLength(obj, 'utf8')\n    return this._pushInt(len, MT.UTF8_STRING) && this.pushWrite(obj, 5, len)\n  }\n\n  _pushBoolean (obj) {\n    return this._pushUInt8(obj ? TRUE : FALSE)\n  }\n\n  _pushUndefined (obj) {\n    return this._pushUInt8(UNDEFINED)\n  }\n\n  _pushArray (gen, obj) {\n    const len = obj.length\n    if (!gen._pushInt(len, MT.ARRAY)) {\n      return false\n    }\n    for (let j = 0; j < len; j++) {\n      if (!gen.pushAny(obj[j])) {\n        return false\n      }\n    }\n    return true\n  }\n\n  _pushTag (tag) {\n    return this._pushInt(tag, MT.TAG)\n  }\n\n  _pushDate (gen, obj) {\n    // Round date, to get seconds since 1970-01-01 00:00:00 as defined in\n    // Sec. 2.4.1 and get a possibly more compact encoding. Note that it is\n    // still allowed to encode fractions of seconds which can be achieved by\n    // changing overwriting the encode function for Date objects.\n    return gen._pushTag(TAG.DATE_EPOCH) && gen.pushAny(Math.round(obj / 1000))\n  }\n\n  _pushBuffer (gen, obj) {\n    return gen._pushInt(obj.length, MT.BYTE_STRING) && gen.push(obj)\n  }\n\n  _pushNoFilter (gen, obj) {\n    return gen._pushBuffer(gen, obj.slice())\n  }\n\n  _pushRegexp (gen, obj) {\n    return gen._pushTag(TAG.REGEXP) && gen.pushAny(obj.source)\n  }\n\n  _pushSet (gen, obj) {\n    if (!gen._pushInt(obj.size, MT.ARRAY)) {\n      return false\n    }\n    for (const x of obj) {\n      if (!gen.pushAny(x)) {\n        return false\n      }\n    }\n    return true\n  }\n\n  _pushUrl (gen, obj) {\n    return gen._pushTag(TAG.URI) && gen.pushAny(obj.format())\n  }\n\n  _pushBigint (obj) {\n    let tag = TAG.POS_BIGINT\n    if (obj.isNegative()) {\n      obj = obj.negated().minus(1)\n      tag = TAG.NEG_BIGINT\n    }\n    let str = obj.toString(16)\n    if (str.length % 2) {\n      str = '0' + str\n    }\n    const buf = Buffer.from(str, 'hex')\n    return this._pushTag(tag) && this._pushBuffer(this, buf)\n  }\n\n  _pushBigNumber (gen, obj) {\n    if (obj.isNaN()) {\n      return gen._pushNaN()\n    }\n    if (!obj.isFinite()) {\n      return gen._pushInfinity(obj.isNegative() ? -Infinity : Infinity)\n    }\n    if (obj.isInteger()) {\n      return gen._pushBigint(obj)\n    }\n    if (!(gen._pushTag(TAG.DECIMAL_FRAC) &&\n      gen._pushInt(2, MT.ARRAY))) {\n      return false\n    }\n\n    const dec = obj.decimalPlaces()\n    const slide = obj.multipliedBy(new Bignumber(10).pow(dec))\n    if (!gen._pushIntNum(-dec)) {\n      return false\n    }\n    if (slide.abs().isLessThan(MAXINT_BN)) {\n      return gen._pushIntNum(slide.toNumber())\n    } else {\n      return gen._pushBigint(slide)\n    }\n  }\n\n  _pushMap (gen, obj) {\n    if (!gen._pushInt(obj.size, MT.MAP)) {\n      return false\n    }\n\n    return this._pushRawMap(\n      obj.size,\n      Array.from(obj)\n    )\n  }\n\n  _pushObject (obj) {\n    if (!obj) {\n      return this._pushUInt8(NULL)\n    }\n\n    var len = this.semanticTypes.length\n    for (var i = 0; i < len; i++) {\n      if (obj instanceof this.semanticTypes[i][0]) {\n        return this.semanticTypes[i][1].call(obj, this, obj)\n      }\n    }\n\n    var f = obj.encodeCBOR\n    if (typeof f === 'function') {\n      return f.call(obj, this)\n    }\n\n    var keys = Object.keys(obj)\n    var keyLength = keys.length\n    if (!this._pushInt(keyLength, MT.MAP)) {\n      return false\n    }\n\n    return this._pushRawMap(\n      keyLength,\n      keys.map((k) => [k, obj[k]])\n    )\n  }\n\n  _pushRawMap (len, map) {\n    // Sort keys for canoncialization\n    // 1. encode key\n    // 2. shorter key comes before longer key\n    // 3. same length keys are sorted with lower\n    //    byte value before higher\n\n    map = map.map(function (a) {\n      a[0] = Encoder.encode(a[0])\n      return a\n    }).sort(utils.keySorter)\n\n    for (var j = 0; j < len; j++) {\n      if (!this.push(map[j][0])) {\n        return false\n      }\n\n      if (!this.pushAny(map[j][1])) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  /**\n   * Alias for `.pushAny`\n   *\n   * @param {*} obj\n   * @returns {boolean} true on success\n   */\n  write (obj) {\n    return this.pushAny(obj)\n  }\n\n  /**\n   * Push any supported type onto the encoded stream\n   *\n   * @param {any} obj\n   * @returns {boolean} true on success\n   */\n  pushAny (obj) {\n    var typ = toType(obj)\n\n    switch (typ) {\n      case 'Number':\n        return this._pushNumber(obj)\n      case 'String':\n        return this._pushString(obj)\n      case 'Boolean':\n        return this._pushBoolean(obj)\n      case 'Object':\n        return this._pushObject(obj)\n      case 'Array':\n        return this._pushArray(this, obj)\n      case 'Uint8Array':\n        return this._pushBuffer(this, Buffer.isBuffer(obj) ? obj : Buffer.from(obj))\n      case 'Null':\n        return this._pushUInt8(NULL)\n      case 'Undefined':\n        return this._pushUndefined(obj)\n      case 'Map':\n        return this._pushMap(this, obj)\n      case 'Set':\n        return this._pushSet(this, obj)\n      case 'URL':\n        return this._pushUrl(this, obj)\n      case 'BigNumber':\n        return this._pushBigNumber(this, obj)\n      case 'Date':\n        return this._pushDate(this, obj)\n      case 'RegExp':\n        return this._pushRegexp(this, obj)\n      case 'Symbol':\n        switch (obj) {\n          case SYMS.NULL:\n            return this._pushObject(null)\n          case SYMS.UNDEFINED:\n            return this._pushUndefined(undefined)\n          // TODO: Add pluggable support for other symbols\n          default:\n            throw new Error('Unknown symbol: ' + obj.toString())\n        }\n      default:\n        throw new Error('Unknown type: ' + typeof obj + ', ' + (obj ? obj.toString() : ''))\n    }\n  }\n\n  finalize () {\n    if (this.offset === 0) {\n      return null\n    }\n\n    var result = this.result\n    var resultLength = this.resultLength\n    var resultMethod = this.resultMethod\n    var offset = this.offset\n\n    // Determine the size of the buffer\n    var size = 0\n    var i = 0\n\n    for (; i < offset; i++) {\n      size += resultLength[i]\n    }\n\n    var res = Buffer.allocUnsafe(size)\n    var index = 0\n    var length = 0\n\n    // Write the content into the result buffer\n    for (i = 0; i < offset; i++) {\n      length = resultLength[i]\n\n      switch (resultMethod[i]) {\n        case 0:\n          result[i].copy(res, index)\n          break\n        case 1:\n          res.writeUInt8(result[i], index, true)\n          break\n        case 2:\n          res.writeUInt16BE(result[i], index, true)\n          break\n        case 3:\n          res.writeUInt32BE(result[i], index, true)\n          break\n        case 4:\n          res.writeDoubleBE(result[i], index, true)\n          break\n        case 5:\n          res.write(result[i], index, length, 'utf8')\n          break\n        default:\n          throw new Error('unkown method')\n      }\n\n      index += length\n    }\n\n    var tmp = res\n\n    this._reset()\n\n    return tmp\n  }\n\n  _reset () {\n    this.result = []\n    this.resultMethod = []\n    this.resultLength = []\n    this.offset = 0\n  }\n\n  /**\n   * Encode the given value\n   * @param {*} o\n   * @returns {Buffer}\n   */\n  static encode (o) {\n    const enc = new Encoder()\n    const ret = enc.pushAny(o)\n    if (!ret) {\n      throw new Error('Failed to encode input')\n    }\n\n    return enc.finalize()\n  }\n}\n\nmodule.exports = Encoder\n"]},"metadata":{},"sourceType":"script"}